測試
====

軟體測試
--------

* 單元測試
* 功能測試
* 整合測試
* 系統測試
* 壓力測試
* 使用者測試
* 單元：程式中類別的方法或是函式
* 測試：驗證程式執行後預期的結果

單元測試的優點
--------

### 為重構提供了保障

在我們新增或修改程式時，測試能確保舊的功能不受影響

### 讓開發者思考設計的範疇

在測試驅動開發 (TDD) 模式下，測試其實就是設計

### 自動測試

不需人工來一項一項地測試，讓測試工具一次幫我們完成

單元測試的缺點
--------

### 測試太花時間?

* 測試寫的少， Debug 到老~
* 利用測試來節省尋找 Bug 的時間

### 沒有程式？怎麼測試？

* 測試就是讓我們確認程式應該要表現出來的行為，所以反過來從結果去推演出程式會更容易
* 測試就是我們期望的結果

Test-Driven Development 測試驅動開發
--------

### 測試先行

將客戶的需求都轉換成測試，通過測試就是完成需求

### 讓程式開發的方向有所依據

測試先行會讓程式開發方向收歛在一定的合理範圍中，不會想到什麼做什麼

PHPUnit
--------

* xUnit 系列
* 從 PEAR 安裝
* 第一個範例

怎麼樣算是好測試
--------

### 說明開發者要表達的意圖

測試就像程式的說明文件，要能清楚傳達出如何使用這支程式

### 分離程式，以便測試

切細程式的功能，將能夠單獨測試的部份獨立出來

### 測試結果要跟預期一樣

* 測試出預期結果是應該的，而且不能只有一次正確
* 除非功能改變，否則在修改程式後都要是一直正確的

### 好測試要可被依賴

* 單元測試要保證程式的正確性，那麼單元測試也一定要值得信任
* 測試也要整潔且易於維護

PHPUnit 的幾大特色
--------

### phpunit.xml

將相關設定放在 XML 檔案中，就不需要每一次都在指令列加上選項

### bootstrap.php

* 執行測試前的初始化
* 一般是自動載入類別

### Data Providers

不需要為不同的測試資料重複相同的程式碼

### Expected Exception

預期程式會出現語法不正確以外的錯誤或異常

#### 為什麼要測試錯誤

因為不能預期使用者會按照正常方法來使用程式，所以測試各種狀況就是必要的動作

#### 沒錯反而是錯的？

當程式明顯不能接受某些輸入值時，程式應該出現異常，而我們要能確保這件事的發生

### Fixtures

為每個測試案例準備同一組測試物件，以省去在每個測試方法中建立測試物件的成本

### Group Testing

    phpunit --group fakeobject .

將同性質 (套件、專案) 的測試案例組織起來一起測試

### Doubles

對未產生或建立過程複雜的物件進行模擬以區隔它們對測試的影響

* Mock Object (動態)
* Stub (靜態)

### 為什麼需要 Mock Object

#### 隔離未實作的類別

在團隊開發時，伙伴負責的類別尚未完成，我們必須隔離掉該部份對目前單元的影響

### 無法使用線上開發

像是線上刷卡等需要跟外部連線的環境等

### Code Coverage Analysis

透過 Xdebug 來讓 PHPUnit 找出 測試所涵蓋到的程式碼

### 為什麼要知道測試涵蓋範圍

#### 找出尚未測試的部份

    phpunit --coverage-html ./report SubjectTest.php

* 程式碼測試的涵蓋範圍越廣，程式就更加可靠
* 不要追求 100% 的涵蓋率

只測試有複雜演算的程式
--------

資料樣本很多，而且容易出現不同結果的狀況之下，就需要測試